<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:ui="http://java.sun.com/jsf/facelets"  
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/templates/template.xhtml">   
<ui:define name="centro">
<f:view>
	<f:metadata>
		<f:viewParam name="tipoEstacao" value="#{volumeBean.tipoEstacao}"/>
	</f:metadata>
	 
	<h:head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	</h:head>

	<h:body>
		<div class="geral">
		<br />
		<h:form id="form" prependId="true">
		<h:inputHidden value="#{volumeBean.tipoEstacao}"/>
		<p:messages autoUpdate="true" id="msg" />
		<table>
			<tr>
				<td class="caminho">#{m.voce_esta_aqui}:</td>
				<td class="sessao"> Movimento </td>
				<td class="sessao"> &raquo; Volume de Água </td>
				<td class="pagina"> &raquo; #{volumeBean.tipoEstacao}</td>
			</tr>
		</table>
		</h:form>
		 
		<p:confirmDialog message="Confirmar a ExclusÃ£o do Registro?" appendToBody="true" header="ExclusÃ£o de Registro" severity="alert"	widgetVar="cd">
			<p:commandButton value="#{m.sim}" actionListener="#{volumeBean.excluir}" update=":formConsulta" oncomplete="PF('cd').hide()"/>
			<p:commandButton value="#{m.nao}" onclick="PF('cd').hide();" type="button" />
		</p:confirmDialog>
		 
		<h:form id="formConsulta" prependId="false">
		<p:panel rendered="#{volumeBean.visualizando}">
			<p:dataTable var="var" id="tabela" value="#{volumeBean.listaVolume}" lazy="true" widgetVar="medidaTable" paginator="true" paginatorPosition="bottom" rows="10" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" editable="false" emptyMessage="Nenhum Registro Encontrado">
			  	
			  	<p:column headerText="#{m.opcoes}" width="90" style="text-align:left">
					<p:commandButton styleClass="imagemVisualizar" value="" title="#{m.consultar}" action="#{volumeBean.consultar}" ajax="false">
						<f:setPropertyActionListener value="#{var}" target="#{volumeBean.selecionadoLista}" />
					</p:commandButton>
					<p:commandButton styleClass="imagemEditar" value="" title="#{m.alterar}" action="#{volumeBean.alterar}" ajax="false">
						<f:setPropertyActionListener value="#{var}" target="#{volumeBean.selecionadoLista}" />
					</p:commandButton>
					<p:commandButton styleClass="imagemExcluir" value="" title="#{m.excluir}" update=":formConsulta" oncomplete="PF('cd').show()">
						<f:setPropertyActionListener value="#{var.id}" target="#{volumeBean.pk}" />
					</p:commandButton>
				</p:column>
					
				<p:column filterBy="#{var.nomeEstacao}" headerText="#{volumeBean.tipoEstacao}" filterMatchMode="contains" style="text-align:left">
					<h:outputText value="#{var.nomeEstacao}" />
				</p:column>					
		
				<p:column filterBy="#{var.referencia}" styleClass="data" headerText="#{m.referencia}" filterMatchMode="contains" style="text-align:left">
					<h:outputText value="#{var.referencia}">
						<f:converter converterId="operacional.MesReferenciaConverter"/>
					</h:outputText>
				</p:column>
			</p:dataTable>
			 
			<p:column>
				<p:commandButton value="Novo" action="#{volumeBean.novo}" update=":formCadastro,:formConsulta"/>
			</p:column>
			 
			</p:panel>
			<script type="text/javascript">
				$(function(){
					$(".data input").setMask('99/9999');
					});
			</script>		
			
		</h:form>
		
		 
		<h:form id="formCadastro">
		<p:panel id="pgrCadastro" rendered="#{!volumeBean.visualizando}">
			<div class='campos_cadastro'>
				<div>
					<h:outputLabel for="regional" value="#{m.regional} *"/>
					<p:selectOneMenu id="regional" value="#{volumeBean.cadastro.cdRegional}" disabled="#{volumeBean.confirmando or volumeBean.editando or volumeBean.desabilitaForm}" effect="fade" required="true" requiredMessage="Regional, deve ser informado.">
							<f:selectItem itemLabel="Selecione" itemValue="" />
						    <f:selectItems value="#{volumeBean.regionais}" var="x" itemLabel="#{x.nome}" itemValue="#{x.codigo}"/>
					         <p:ajax update="unidadenegocio, municipio, localidade, estacao" event="change" />  
				    </p:selectOneMenu>
				</div>
				
				<div>
					<h:outputLabel for="unidadenegocio" value="#{m.unidade_negocio} *" />
				    <p:selectOneMenu id="unidadenegocio" value="#{volumeBean.cadastro.cdUnidadeNegocio}" disabled="#{volumeBean.confirmando or volumeBean.editando or volumeBean.desabilitaForm}" effect="fade" required="true" requiredMessage="Unidade de NegÃ³cio, deve ser informado.">
				    		<f:selectItem itemLabel="Selecione" itemValue="" />
					        <f:selectItems value="#{volumeBean.unidadesNegocio}" var="x" itemLabel="#{x.nome}" itemValue="#{x.codigo}"/>
					        <p:ajax update="municipio, localidade, estacao" event="change" />  
				    </p:selectOneMenu> 
				</div>
				
				<div>
					<h:outputLabel for="municipio" value="#{m.municipio} *" />
				    <p:selectOneMenu id="municipio" value="#{volumeBean.cadastro.cdMunicipio}" disabled="#{volumeBean.confirmando or volumeBean.editando or volumeBean.desabilitaForm}" effect="fade" required="true" requiredMessage="MunicÃ­pio, deve ser informado." >
				    		<f:selectItem itemLabel="Selecione" itemValue="" />
					        <f:selectItems value="#{volumeBean.municipios}" var="x" itemLabel="#{x.nome}" itemValue="#{x.codigo}"/>
					        <p:ajax update="localidade, estacao" event="change" />  
				    </p:selectOneMenu>
				</div>
				
				<div>
					<h:outputLabel for="localidade" value="#{m.localidade} *" />
				    <p:selectOneMenu id="localidade" value="#{volumeBean.cadastro.cdLocalidade}" disabled="#{volumeBean.confirmando or volumeBean.editando or volumeBean.desabilitaForm}" effect="fade" required="true" requiredMessage="Localidade, deve ser informado." >
				    		<f:selectItem itemLabel="Selecione" itemValue="" />
					        <f:selectItems value="#{volumeBean.localidades}" var="x" itemLabel="#{x.nome}" itemValue="#{x.codigo}"/>
					        <p:ajax update="estacao" event="change" />  
				    </p:selectOneMenu>
				</div>
				
				<div>
					<h:outputLabel for="estacao" value="#{volumeBean.tipoEstacao} *"/>
					<p:selectOneMenu id="estacao" value="#{volumeBean.cadastro.cdUnidadeOperacional}" converter="selectOneConverter" effect="fade" disabled="#{volumeBean.desabilitaForm or volumeBean.editando}" required="true" requiredMessage="#{volumeBean.tipoEstacao}, deve ser informado.">
						<f:selectItem itemLabel="Selecione" itemValue="" /> 
			         	<f:selectItems value="#{volumeBean.estacoesOperacionais}" var="estacao" itemLabel="#{estacao.nome}" itemValue="#{estacao.pk.id}"/> 
			         
			         	<p:ajax listener="#{volumeBean.carregarFluxoSaida}" update="tabelaFluxoSaida" event="change"/>  
			         
		    		</p:selectOneMenu>
				</div>
				
				<div>
					<h:outputLabel for="referencia" value="#{m.referencia} *"/>
					<p:inputText value="#{volumeBean.cadastro.referencia}" id="referencia" style="width: 80px" disabled="#{volumeBean.desabilitaForm or volumeBean.editando}" size="8" required="true" requiredMessage="#{m.referencia_obrigatoria}">
						<f:converter converterId="operacional.MesReferenciaConverter"/>
					</p:inputText>				
				</div>
				
				<div>
					<h:outputLabel for="datahoramedicao" value="Data/Hora MediÃ§Ã£o *" />
					<p:calendar value="#{volumeBean.cadastro.dataHoraMedicao}" id="datahoramedicao" locale="pt" disabled="#{volumeBean.desabilitaForm}"
						showOn="button" pattern="dd/MM/yyyy HH:mm" required="true" requiredMessage="Data e Hora de MediÃ§Ã£o, deve ser informado." />
				</div>

				<div>
					<h:outputLabel for="estimado" value="Valor Estimado *" />
					<p:selectOneMenu id="estimado" value="#{volumeBean.cadastro.estimado}" effect="fade" disabled="#{volumeBean.desabilitaForm}" required="true" requiredMessage="Estimativa, deve ser informada.">
						<f:selectItem itemLabel="Selecione" itemValue="" />
						<f:selectItem itemLabel="SIM" itemValue="true" />
						<f:selectItem itemLabel="NÃƒO" itemValue="false" />
					</p:selectOneMenu>
				</div>

				<div>
					<h:outputLabel for="volume" value="Volume" />
					<p:inputText style="width: 80px !important;" value="#{volumeBean.cadastro.volume}" id="volume" maxlength="10" disabled="#{volumeBean.desabilitaForm}" />
				</div>
			
			</div>
			
			<div>
				<h:dataTable var="volume" id="tabelaFluxoSaida" value="#{volumeBean.cadastro.volumesFluxo}" editable="true" styleClass="tabela_app" headerClass="tabela_header">
					<f:facet name="header">#{m.medidor_saida}</f:facet>
					
					<h:column headerClass="tabela_column_header">
						<f:facet name="header">
							<h:outputText value="#{m.medidor_saida}" />
						</f:facet>
						<h:outputText value="#{volume.macroMedidor.identificadorLeitura}" styleClass="tabela_row"/>
					</h:column>
					
					<h:column headerClass="tabela_column_header">
						<f:facet name="header">
							<h:outputText value="#{m.tipo_medicao}" />
						</f:facet>
						<h:outputText value="#{volume.macroMedidor.descricaoTipoMedicao}" styleClass="tabela_row"/>
					</h:column>
					
					<h:column headerClass="tabela_column_header">
						<f:facet name="header">
							<h:outputText value="#{m.medicao}" />
						</f:facet>
						<p:inputText style="width: 80px" value="#{volume.volumeMedicao}" id="vazao" maxlength="10" disabled="#{eeabVolumeBean.desabilitaForm}"
							required="true" requiredMessage="Valor da MediÃ§Ã£o de SaÃ­da, deve ser informado." />
					</h:column>
				</h:dataTable>
				<!--  <h:outputText value="#{m.nenhum_registro_encontrado}"  styleClass="tabela_row" rendered="#{empty eeabVolumeBean.registro.volumeSaida}"/>  -->
			</div>
			
			<!-- 
			<div>
				<p:dataTable var="var" id="tabela" value="#{horasBean.cadastro.cmbs}" paginator="false" editable="true">
			        <f:facet name="header">  
			            Conjunto Motor-Bomba
			        </f:facet> 			
					<p:column style="text-align:left">
				  		<f:facet name="header">
							<h:outputText class="tabela" value="CMB"/>
						</f:facet>
		                <h:outputText value="#{var.cmb}"/>
					</p:column>					
					<p:column style="text-align:right">
				  		<f:facet name="header">
							<h:outputText class="tabela" value="#{m.registro_consumo} (horas)"/>
						</f:facet>	
						<p:inputText style="width: 80px" value="#{var.medicao}" id="medicao" maxlength="10" disabled="#{horasBean.desabilitaForm}" required="true" requiredMessage="Valor da MediÃ§Ã£o de CMB, deve ser informado.">
			         		<p:ajax update=":formCadastro:horasSistema" event="keyup"/>
						</p:inputText>
						<script type="text/javascript">
							$(function(){
								$("input[id*=medicao]").setMask("simple-decimal-us");					
								});
						</script>	
					</p:column>
				</p:dataTable>
			</div>
		
			<div class='campos_cadastro'>
				<div>
					<h:outputLabel for="medicaoEnergia" class="label_maior" value="#{m.horas_paradas_energia}: "/>
					<p:inputText style="width: 80px" value="#{horasBean.cadastro.paradaPorEnergia}" id="medicaoEnergia" maxlength="10" disabled="#{horasBean.desabilitaForm}">
		         		<p:ajax update=":formCadastro:horasSistema" event="keyup"/>
					</p:inputText>
				</div>
				<div>
					<h:outputLabel for="medicaoManutencao" class="label_maior" value="#{m.horas_paradas_manutencao}: "/>
					<p:inputText style="width: 80px" value="#{horasBean.cadastro.paradaPorManutencao}" id="medicaoManutencao" maxlength="10" disabled="#{horasBean.desabilitaForm}">
		         		<p:ajax update=":formCadastro:horasSistema" event="keyup"/>
					</p:inputText>
				</div>
				<div>
					<h:outputLabel for="medicaoControle" class="label_maior" value="#{m.horas_paradas_controle}: "/>
					<p:inputText style="width: 80px" value="#{horasBean.cadastro.paradaPorControle}" id="medicaoControle" maxlength="10" disabled="#{horasBean.desabilitaForm}">
		         		<p:ajax update=":formCadastro:horasSistema" event="keyup"/>
					</p:inputText>
				</div>
			</div>
			
			
			<div align="right">
				<h:outputLabel for="horasSistema" class="tabela" value="#{m.total_horas_cmb}: "/>
				<h:outputText class="tabela" id="horasSistema" value="#{horasBean.horasSistema}" style="width:80px; display:inline-block; text-align: right">
					<f:convertNumber pattern="#0.00"/>
				</h:outputText>
			</div>
			
			<div align="right" style="margin-top:10px">
				<h:outputLabel for="horasMes" class="tabela" value="#{m.total_horas_mes}: "/>
				<h:outputText id="horasMes" class="tabela" value="#{horasBean.horasMes}" style="width:80px; display:inline-block; text-align: right">
					<f:convertNumber pattern="#0.00"/>
				</h:outputText>
			</div>
			
			<div>
				<p:commandButton value="Cadastrar" action="#{horasBean.cadastrar}" rendered="#{horasBean.cadastrando or horasBean.editando}" update="formCadastro"/>
				<p:commandButton value="Confirmar" action="#{horasBean.confirmar}" rendered="#{horasBean.confirmando}" update="formCadastro"/>
				<p:commandButton value="Cancelar" action="#{horasBean.cancelar}" rendered="#{horasBean.confirmando}" update="formCadastro"/>
				<p:commandButton value="Limpar" rendered="#{horasBean.cadastrando}" type="reset" />
				<p:commandButton process="@this" value="Voltar" action="#{horasBean.voltar}" rendered="#{!horasBean.confirmando}" update=":formCadastro,:formConsulta"/>
			</div>
		-->
		</p:panel>
		<script type="text/javascript">
			$(function(){
				options = {
					    monthNames: ['Janeiro', 'Fevereiro', 'Mar&ccedil;o', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
					};	
				$("input[id*=referencia]").monthpicker(options);						
		
				$("input[id*=medicao]").setMask("simple-decimal-us");				
				});
		</script>
		</h:form>
		</div>
	</h:body>
</f:view>
</ui:define>
</ui:composition>
</html>
